<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora | Carib√∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f9f9f9;
        }
        .container {
            max-width: 1200px;
            margin: auto;
        }
        .search-box {
            margin-bottom: 20px;
        }
        input[type="text"] {
            padding: 8px;
            width: 200px;
            font-size: 16px;
        }
        button {
            padding: 8px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .result {
            display: none;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .note {
            background: #fff3cd;
            padding: 10px;
            border-left: 4px solid #ffc107;
            margin-top: 15px;
            font-size: 0.9em;
        }
        .section {
            margin: 20px 0;
        }
        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .level-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        .card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.1);
            width: 200px;
        }
        .progress-bar {
            height: 6px;
            background: #eee;
            border-radius: 3px;
            margin: 8px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: #28a745;
        }
        h1 {
            color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Calculadora | Carib√∫</h1>

        <div class="search-box">
            <label for="dniInput">Buscar por DNI:</label><br>
            <input type="text" id="dniInput" placeholder="Ej: 77632784">
            <button onclick="buscarPorDNI()">Buscar</button>
            <div id="status">Escribe y espera un segundo.</div>
        </div>

        <div id="result" class="result">
            <div class="info-box">
                <h2 id="nombreCompleto"></h2>
                <p><strong>DNI:</strong> <span id="dni"></span></p>
                <p><strong>CAMPA√ëA:</strong> <span id="campana"></span></p>
                <p><strong>PERIODO:</strong> <span id="periodo"></span></p>
                <p><strong>SUPERVISOR:</strong> <span id="supervisor"></span></p>
                <p><strong>ESPINIOZA JES√öS ALEJANDRO</strong></p>
                <p><strong>COORDINADOR:</strong> <span id="coordinador"></span></p>
                <p><strong>VENTAS:</strong> <span id="ventas"></span></p>
                <p><strong>VENTAS PROY:</strong> <span id="ventasProy"></span></p>
                <p><strong>NIVEL PROY:</strong> <span id="nivelProy"></span></p>
            </div>

            <div class="note">
                ‚ö†Ô∏è Nota: El monto indicado es referencial y est√° sujeto a variaciones por la aplicaci√≥n de penalizadores y bonificadores, por lo que no representa un valor definitivo.
            </div>

            <div class="section">
                <div class="section-title">
                    <span>Rangos principales</span>
                </div>
                <div class="level-cards" id="rangosPrincipales">
                    <!-- Se llenar√° con JS -->
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    <span>Nivel 1</span>
                    <span>‚ñ≤</span>
                </div>
                <div class="level-cards" id="nivel1">
                    <!-- Se llenar√° con JS -->
                </div>
                <div style="text-align: center; background: #e3f2fd; padding: 10px; margin-top: 10px;">
                    <strong>Total N1: S/ <span id="totalN1">0.00</span></strong>
                </div>
            </div>

            <div class="section">
                <div class="section-title">
                    <span>Nivel 2</span>
                    <span>‚ñ≤</span>
                </div>
                <div class="level-cards" id="nivel2">
                    <!-- Se llenar√° con JS -->
                </div>
                <div style="text-align: center; background: #e3f2fd; padding: 10px; margin-top: 10px;">
                    <strong>Total N2: S/ <span id="totalN2">0.00</span></strong>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSurBIXBz-zxgpeTzfypry62oOkEvUpRZ-NK7XopbQbCz87sZJFuBUhPTBS17HVxHLuO0kYPe2r3YT0/pub?gid=187586138&single=true&output=csv';

        async function buscarPorDNI() {
            const dniInput = document.getElementById('dniInput').value.trim();
            if (!dniInput) {
                alert('Por favor ingresa un DNI');
                return;
            }

            document.getElementById('status').textContent = 'Buscando...';
            document.getElementById('result').style.display = 'none';

            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                const lines = csvText.split('\n');
                const headers = lines[0].split(',');

                let foundRow = null;

                for (let i = 1; i < lines.length; i++) {
                    const row = lines[i].split(',');
                    if (row[0] === dniInput) {
                        foundRow = row;
                        break;
                    }
                }

                if (!foundRow) {
                    document.getElementById('status').textContent = 'No se encontr√≥ el DNI.';
                    return;
                }

                // Mapear datos
                const data = {};
                headers.forEach((header, index) => {
                    data[header.trim()] = foundRow[index] ? foundRow[index].trim() : '';
                });

                // Rellenar el DOM
                document.getElementById('nombreCompleto').textContent = `${data['NOMBRE']} ${data['APELLIDO']}`.toUpperCase();
                document.getElementById('dni').textContent = data['DNI'];
                document.getElementById('campana').textContent = data['CAMPA√ëA'] || 'CARIB√ö';
                document.getElementById('periodo').textContent = data['PERIODO'] || '202509';
                document.getElementById('supervisor').textContent = data['SUPERVISOR'] || 'BRACAMONTE';
                document.getElementById('coordinador').textContent = data['COORDINADOR'] || 'ANDY FERNANDEZ';
                document.getElementById('ventas').textContent = data['VENTAS'] || '0';
                document.getElementById('ventasProy').textContent = data['VENTAS PROY'] || '0';
                document.getElementById('nivelProy').textContent = data['NIVEL PROY'] || 'NIVEL 1';

                // Limpiar rangos anteriores
                document.getElementById('rangosPrincipales').innerHTML = '';
                document.getElementById('nivel1').innerHTML = '';
                document.getElementById('nivel2').innerHTML = '';

                // Rangos principales (se asume que son totales generales)
                const rangos = [
                    { rango: '<25.9 - 29.9', valor: data['SEMANA 1'] || '0' },
                    { rango: '<29.9 - 35.9', valor: data['SEMANA 2'] || '0' },
                    { rango: '36 A MAS', valor: data['SEMANA 3'] || '0' }
                ];

                rangos.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <div>${r.rango}</div>
                        <div><strong>${r.valor}</strong></div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${Math.min(100, parseInt(r.valor) / 10)}%"></div></div>
                    `;
                    document.getElementById('rangosPrincipales').appendChild(card);
                });

                // Nivel 1
                const nivel1Data = [
                    { rango: '<25.9 - 29.9', valor: data['SEMANA 1'] || '0', monto: '192.00' },
                    { rango: '<29.9 - 35.9', valor: data['SEMANA 2'] || '0', monto: '19.00' },
                    { rango: '36 A MAS', valor: data['SEMANA 3'] || '0', monto: '8.00' }
                ];

                let totalN1 = 0;
                nivel1Data.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    const montoNum = parseFloat(r.monto);
                    totalN1 += montoNum;
                    card.innerHTML = `
                        <div>${r.rango}</div>
                        <div><strong>S/ ${r.monto}</strong></div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${Math.min(100, parseInt(r.valor) / 10)}%"></div></div>
                    `;
                    document.getElementById('nivel1').appendChild(card);
                });
                document.getElementById('totalN1').textContent = totalN1.toFixed(2);

                // Nivel 2
                const nivel2Data = [
                    { rango: '<25.9 - 29.9', valor: data['SEMANA 4'] || '0', monto: '240.00' },
                    { rango: '<29.9 - 35.9', valor: data['SEMANA 5'] || '0', monto: '23.00' },
                    { rango: '36 A MAS', valor: data['TOTAL GENERAL'] || '0', monto: '10.00' }
                ];

                let totalN2 = 0;
                nivel2Data.forEach(r => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    const montoNum = parseFloat(r.monto);
                    totalN2 += montoNum;
                    card.innerHTML = `
                        <div>${r.rango}</div>
                        <div><strong>S/ ${r.monto}</strong></div>
                        <div class="progress-bar"><div class="progress-fill" style="width: ${Math.min(100, parseInt(r.valor) / 10)}%"></div></div>
                    `;
                    document.getElementById('nivel2').appendChild(card);
                });
                document.getElementById('totalN2').textContent = totalN2.toFixed(2);

                document.getElementById('result').style.display = 'block';
                document.getElementById('status').textContent = '¬°Resultado encontrado!';

            } catch (error) {
                console.error('Error al cargar los datos:', error);
                document.getElementById('status').textContent = 'Error al cargar los datos.';
            }
        }
    </script>
</body>
</html>
